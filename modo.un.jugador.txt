#include <iostream>
using namespace std;
#include "modounjugador.h"
#include <conio.h>

//----------------------------------------------------------------------------------------------------------------------

void mostrarbloqueadores(int bloq[]){

    cout<<"Los bloqueadores son: ";
    cout<<bloq[0]<<" Y "<<bloq[1];

}

//----------------------------------------------------------------------------------------------------------------------

int bloqueadores(int bloq[]){

    cout << endl << "Presione enter para tirar dados bloqueadores ...";
    system("pause>nul");
    cout<<endl<<endl;

    bloq[0]= rand() % 6 + 1;
    bloq[1]= rand() % 6 + 1;


}

//----------------------------------------------------------------------------------------------------------------------

int tirada (int dados[],int &cantidadDados){

    int i;

    for(i=0;i<cantidadDados;i++){

        dados[i] = rand() % 6 + 1;
    }

}

//----------------------------------------------------------------------------------------------------------------------

void mostrarTirada(int dados[],int &cantidadDados){

    int i;

    cout<<endl<<endl<<"DADOS: ";

    for (i=0;i<cantidadDados;i++){

        cout<<dados[i]<<"  ";
    }

    cout<<endl<<endl;

}

//----------------------------------------------------------------------------------------------------------------------

void mostrarPuntajeTirada (int bloq[],int dados[],int &cantidadDados,int &puntajeTirada,int &puntajeRonda, char &desicion, bool &sonTodosIguales){

    int i,cont=0, sumaTodosIguales=0;


    for(i=0;i<cantidadDados;i++){

        if(dados[i] != bloq[0] && dados[i] != bloq[1]){

            puntajeTirada += dados[i];
        }
    }

    for(i=0;i<cantidadDados;i++){

        if(dados[i] == bloq[0] || dados[i] == bloq[1]){

            cont++;

        }
    }

    sonTodosIguales = todosIguales(bloq,dados,cantidadDados);

    cantidadDados=cantidadDados-cont;

    if (cantidadDados==0){

        puntajeTirada = 0;
        desicion = 'n';
        cout<<endl<<"Usted ha perdido todos los puntos"<<endl;
        return;

    }

    if (sonTodosIguales==false){

    cout<<"------------------------------------------"<<endl;
    cout<<endl<<"Puntaje de la tirada: "<<puntajeTirada<<endl;
    cout<<"Cantidad de dados disponibles para proxima tirada: "<<cantidadDados<<endl;
    cout<<endl<<"------------------------------------------"<<endl;
    }
    else {

            for(i=0;i<cantidadDados;i++){

            sumaTodosIguales += dados[i];

            }
            puntajeTirada += sumaTodosIguales;
            desicion = 's';
            cout << "Â¡Todos los dados son iguales! Puntaje duplicado: " << puntajeTirada << endl;
            cout << endl << "Estas obligado a tirar nuevamente" << endl;

        }

}

//----------------------------------------------------------------------------------------------------------------------

 bool todosIguales (int bloq[], int dados[],int &cantidadDados){


    for (int i = 1; i < cantidadDados; i++) {
        if (dados[i] != dados[0]) {
            return false;

        }
    }

    if (cantidadDados==1){

        return  false;
    }

    if ( dados[0] != bloq[0] && dados[0] != bloq[1] ) {

        return true;
    }

}




//----------------------------------------------------------------------------------------------------------------------

void Ronda (int bloq[],int dados[],int &cantidadDados,int &puntajeTirada,int &puntajeRonda, char &desicion, bool &sonTodosIguales){

        do{
        tirada (dados,cantidadDados);
        mostrarTirada(dados,cantidadDados);
        mostrarPuntajeTirada(bloq,dados,cantidadDados,puntajeTirada,puntajeRonda,desicion,sonTodosIguales);

            if (desicion == 'n'){

                puntajeRonda=puntajeTirada;
                break;
            }
        if (sonTodosIguales == false){
            cout << endl << endl << "Presione 's' para tirar nuevamente o 'n' para finalizar ronda ...";
            desicion = getch();
                if (desicion == 'n'){

                    puntajeRonda=puntajeTirada;
                    break;
                }
        }
        else {
                cout << endl << "Presione cualquier tecla para continuar ...";
                system("pause>nul");

                }



        }
        while (desicion == 's');

}

//----------------------------------------------------------------------------------------------------------------------

void mostrarPuntajeTotal (int &puntajeRonda,int &puntajeTotal){

    puntajeTotal += puntajeRonda;

    cout<<endl<<endl<<"PUNTAJE TOTAL: "<<puntajeTotal<<endl;

}

//----------------------------------------------------------------------------------------------------------------------

void mostrarPuntajeRonda (int &puntajeRonda){


    cout<<endl<<endl<<"PUNTAJE DE LA RONDA: "<<puntajeRonda<<endl;

}

//----------------------------------------------------------------------------------------------------------------------

void mostrarNombreJugador (string nombreJugador){

    cout<<endl<<endl<<"------------------------------------------------";
    cout<<endl<<endl<<"Jugador: "<<nombreJugador<<endl;

}





void modoUnJugador(){

    int i,puntajeRonda=0,puntajeTotal=0;
    int bloq[2];
    int dados[5];
    char desicion;
    bool sonTodosIguales = false;
    string nombreJugador;

    cout << endl<<" Ingrese nombre: ";
    cin >> nombreJugador;


    for (i=1;i<=3;i++){

        int cantidadDados = 5;
        int puntajeTirada = 0;


        cout<<endl<<"-------------- RONDA "<<i<<" DE 3 --------------"<<endl<<endl;
        bloqueadores (bloq);
        mostrarbloqueadores(bloq);
        cout << endl << endl << "Presione 's' para tirar dados o 'n' para finalizar ronda ...";
        desicion = getch();
            if (desicion=='n'){

                puntajeRonda=puntajeTirada;
                break;
            }
        cout<<endl;
        Ronda(bloq,dados,cantidadDados,puntajeTirada,puntajeRonda,desicion,sonTodosIguales);
        mostrarNombreJugador(nombreJugador);
        mostrarPuntajeRonda(puntajeRonda);
        mostrarPuntajeTotal(puntajeRonda,puntajeTotal);
    }


    cout<<endl<<endl<<"Juego finalizado, acumulaste un total de: "<<puntajeTotal<<" puntos"<<endl;

}







